<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin ‚Äì Koleksiku</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0; padding:0;
  font-family:'Inter',sans-serif;
  background:#0b1622;
  color:#fff;
}
.wrap{
  max-width:560px;
  margin:0 auto;
  padding:20px;
}
h1{
  text-align:center;
  margin-bottom:12px;
  font-size:24px;
  font-weight:700;
}
.tabs{
  display:flex;
  background:#12202e;
  border-radius:12px;
  overflow:hidden;
  margin-bottom:16px;
}
.tab{
  flex:1;
  text-align:center;
  padding:12px 0;
  cursor:pointer;
  background:#12202e;
  color:#b5c2d3;
  font-weight:600;
}
.tab.active{
  background:#ffffff;
  color:#0b1622;
}
.box{
  background:#12202e;
  padding:16px;
  border-radius:14px;
  margin-bottom:18px;
}
textarea{
  width:100%; height:180px;
  border:none; border-radius:10px;
  padding:12px;
  resize:none; outline:none;
  font-size:14px;
}
button{
  width:100%;
  padding:14px;
  background:#ff7f00;
  border:none; border-radius:12px;
  color:#fff; font-weight:700;
  font-size:15px;
  cursor:pointer;
}
button:hover{
  background:#ffa94d;
}
.progress{
  width:100%; height:10px;
  background:#334455;
  border-radius:10px;
  margin:18px 0;
  overflow:hidden;
}
.progress-bar{
  width:0%; height:100%;
  background:#ff7f00;
  transition:0.3s;
}
.log{
  background:#0f1c2a;
  padding:14px;
  border-radius:12px;
  font-size:13px;
  max-height:260px;
  overflow:auto;
  white-space:pre-wrap;
}
</style>
</head>
<body>

<div class="wrap">
  <h1>Admin ‚Äì Koleksiku</h1>

  <!-- TABS -->
  <div class="tabs">
    <div id="tab-sh" class="tab active" onclick="setTab('shopee')">üõí Shopee</div>
    <div id="tab-tk" class="tab" onclick="setTab('tiktok')">üéµ TikTok</div>
  </div>

  <!-- INPUT BOX -->
  <div class="box">
    <textarea id="links" placeholder="Tempel banyak link di sini...&#10;1 link per baris"></textarea>
  </div>

  <button onclick="startProcess()">Tambahkan ke Sheet</button>

  <div class="progress"><div class="progress-bar" id="pb"></div></div>

  <div class="log" id="log">Siap menerima link...</div>
</div>

<script>
const WEBAPP_URL = 
  "https://script.google.com/macros/s/AKfycbw1WzXwKiAaNFMrvKjxWfMIpGLsbnHs9flhnu0MCbGm2ns_kk8URYlfQzptDH-mmf1Z/exec";

let CURRENT = "shopee";

function setTab(x){
  CURRENT = x;
  document.getElementById("tab-sh").classList.toggle("active", x==="shopee");
  document.getElementById("tab-tk").classList.toggle("active", x==="tiktok");
}

function log(msg){
  const lg = document.getElementById("log");
  lg.textContent += "\n" + msg;
  lg.scrollTop = lg.scrollHeight;
}

async function fetchMeta(url){
  try{
    const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(url));
    const html = await res.text();

    const title = html.match(/<meta property="og:title" content="([^"]*)"/i)?.[1]
               || html.match(/<title>([^<]*)<\/title>/i)?.[1]
               || "Produk";

    const image = html.match(/<meta property="og:image" content="([^"]*)"/i)?.[1]
               || "";

    return { title, image };
  }catch(e){
    return { title:"Produk", image:"" };
  }
}

async function startProcess(){
  const lines = document.getElementById("links").value
    .split("\n")
    .map(x=>x.trim())
    .filter(x=>x.length>0);

  if(!lines.length){
    log("‚ùå Tidak ada link.");
    return;
  }

  log("‚è≥ Memulai...");
  let done = 0;

  for(let link of lines){
    const meta = await fetchMeta(link);

    const params = new URLSearchParams({
      link: link,
      title: meta.title,
      image: meta.image,
      no: "",
      source: CURRENT
    });

    try{
      await fetch(WEBAPP_URL + "?" + params.toString());
      log("‚úî Berhasil: " + link);
    }catch{
      log("‚ùå Gagal: " + link);
    }

    done++;
    document.getElementById("pb").style.width = (done/lines.length*100)+"%";
  }

  log("üéâ Selesai menambahkan semua link.");
}
</script>

</body>
</html>
