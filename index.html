<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rekomendasi Outfit</title>

  <!-- performa kecil-kecilan -->
  <link rel="preconnect" href="https://docs.google.com">
  <link rel="preconnect" href="https://down-id.img.susercontent.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0b1622; --card:#ffffff; --text:#0b0f19;
      --brand:#ff6b00; --brand2:#ff914d; --muted:#8aa0b7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:#fff;
    }
    .wrap{max-width:480px;margin:0 auto;padding:0 14px 80px}
    .header{
      position:sticky; top:0; z-index:3;
      background:linear-gradient(90deg,var(--brand2),var(--brand));
      padding:18px 16px 20px; border-radius:0 0 18px 18px; box-shadow:0 6px 14px rgba(0,0,0,.18);
      text-align:center;
    }
    .header h1{margin:0; font-size:20px; font-weight:800}
    .header p{margin:6px 0 0; font-size:13px; opacity:.9}

    .search{
      margin:16px 0 10px; background:#fff; border-radius:26px; padding:8px 12px;
      display:flex; align-items:center; gap:8px; box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    .search input{
      border:none; outline:none; width:100%; font-size:14px; color:#0f172a;
    }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .card{
      background:var(--card); color:var(--text);
      border-radius:14px; overflow:hidden; display:flex; flex-direction:column;
      box-shadow:0 4px 14px rgba(0,0,0,.25); cursor:pointer; transition:transform .12s ease;
    }
    .card:active{transform:scale(.98)}
    .thumb{width:100%; aspect-ratio:1/1; background:#e9eef5; display:block; overflow:hidden}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .body{padding:10px 10px 12px; display:flex; flex-direction:column; gap:6px}
    .name{font-size:13px; font-weight:600; line-height:1.3; height:34px; overflow:hidden}
    .price{font-size:13px; color:var(--brand)}

    .empty{color:var(--muted); text-align:center; margin:36px 0}
    .cta-wa{
      position:fixed; right:16px; bottom:18px; z-index:4;
      background:#25D366; color:#fff; text-decoration:none; border:none;
      padding:12px 16px; border-radius:999px; font-weight:700; box-shadow:0 8px 20px rgba(0,0,0,.28);
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸ§º Rekomendasi Outfit</h1>
    <p>Inspirasi Outfit Kamu</p>
  </div>

  <div class="wrap">
    <div class="search">
      <input id="q" placeholder="Cari produk / tag / #nomor..." />
    </div>

    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none">Gagal memuat data.</div>
  </div>

  <a class="cta-wa" target="_blank" href="https://whatsapp.com/channel/0029VbAjaXOBvvsiyKOMZn2s">Channel WA</a>

  <script>
    // === 1) Link CSV Google Sheet KAMU (sudah di-embed) ===
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnrxnXyTSBK5-681-9abCMWcJZMWUIVhr3z4uhKiiFOf-qPXmKsgc307TAoGniV6ryu-plqUSaCw23/pub?gid=0&single=true&output=csv";

    // === 2) Fallback gambar kalau 403/404 ==
    const NO_IMAGE = "https://via.placeholder.com/300x300?text=No+Image";

    let ALL = [];

    // Buka app Shopee dulu, kalau tidak respons 400ms, fallback ke web
    function openShopee(link) {
      try {
        const deep = "shopee://external?url=" + encodeURIComponent(link);
        const timer = setTimeout(() => window.open(link, "_blank"), 400);
        // pada banyak browser mobile, assignment ke location akan mencoba buka app
        window.location.href = deep;
        // sebagian browser butuh noop untuk tidak error
        void 0;
      } catch (e) {
        // fallback paling aman
        window.open(link, "_blank");
      }
    }

    // Render kartu
    function render(list = ALL) {
      const q = document.getElementById("q").value.trim().toLowerCase();
      const wrap = document.getElementById("list");
      const empty = document.getElementById("empty");
      wrap.innerHTML = "";

      const items = list.filter(p => {
        if (!q) return true;
        return (p.name || "").toLowerCase().includes(q) ||
               (p.tags || "").toLowerCase().includes(q) ||
               String(p.no || "").includes(q);
      });

      empty.style.display = items.length ? "none" : "block";

      items.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => openShopee(p.link);

        const img = document.createElement("img");
        img.src = p.image || NO_IMAGE;
        img.alt = p.name || "Produk";
        img.onerror = () => { img.onerror = null; img.src = NO_IMAGE; };

        const thumb = document.createElement("div");
        thumb.className = "thumb";
        thumb.appendChild(img);

        const body = document.createElement("div");
        body.className = "body";
        const name = document.createElement("div");
        name.className = "name";
        name.textContent = (p.no ? `#${p.no} ` : "") + (p.name || "Produk");

        const price = document.createElement("div");
        price.className = "price";
        if (p.price) price.textContent = p.price;

        body.appendChild(name);
        if (p.price) body.appendChild(price);

        card.appendChild(thumb);
        card.appendChild(body);
        wrap.appendChild(card);
      });
    }

    // Muat CSV dari Sheet â†’ parse aman (tahan koma di dalam kutip)
    async function loadData() {
      try {
        const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error(res.status + " " + res.statusText);
        const csv = await res.text();

        const rows = csv
          .trim()
          .split(/\r?\n/)
          .map(line => {
            const out = [];
            let cur = "", inQ = false;
            for (let i = 0; i < line.length; i++) {
              const ch = line[i];
              if (ch === '"' ) {
                if (inQ && line[i+1] === '"') { cur += '"'; i++; }   // escaped quote
                else inQ = !inQ;
              } else if (ch === ',' && !inQ) {
                out.push(cur); cur = "";
              } else cur += ch;
            }
            out.push(cur);
            return out;
          });

        const [hdr, ...data] = rows;
        const idx = Object.fromEntries(hdr.map((h,i)=>[ (h||"").trim().toLowerCase(), i ]));

        ALL = data.map(r => ({
          no   : (r[idx.no]||"").trim(),
          name : (r[idx.name]||"").replace(/^"|"$/g,"").trim(),
          link : (r[idx.link]||"").replace(/^"|"$/g,"").trim(),
          image: (r[idx.image]||"").replace(/^"|"$/g,"").trim(),
          price: (r[idx.price]||"").replace(/^"|"$/g,"").trim(),
          tags : (r[idx.tags]||"").replace(/^"|"$/g,"").trim()
        }))
        .filter(x => x.link);

        render();
      } catch (err) {
        console.error("Load error:", err);
        document.getElementById("empty").style.display = "block";
        document.getElementById("empty").textContent = "Gagal memuat data.";
      }
    }

    document.getElementById("q").addEventListener("input", () => render());
    loadData();
  </script>
</body>
</html>
