<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rekomendasi Outfit</title>

  <link rel="preconnect" href="https://docs.google.com">
  <link rel="preconnect" href="https://down-id.img.susercontent.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0b1622; --card:#ffffff; --text:#0b0f19;
      --brand:#ff6b00; --brand2:#ff914d; --muted:#8aa0b7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:#fff;
    }

    .wrap{max-width:480px;margin:0 auto;padding:0 14px 80px}

    /* ðŸ”¥ blok paling atas (header + search + tabs) jadi satu sticky */
    .top-shell{
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--bg);
    }

    .header{
      /* tadinya sticky, sekarang normal karena dibungkus .top-shell */
      background:linear-gradient(90deg,var(--brand2),var(--brand));
      padding:18px 16px 20px; border-radius:0 0 18px 18px; box-shadow:0 6px 14px rgba(0,0,0,.18);
      text-align:center;
    }
    .header h1{margin:0; font-size:20px; font-weight:800}
    .header p{margin:6px 0 0; font-size:13px; opacity:.9}

    .top-inner{
      max-width:480px;
      margin:0 auto;
      padding:0 14px 10px;
    }

    /* SEARCH â€“ balik normal (tidak sticky sendiri, karena ikut .top-shell) */
    .search{
      margin:16px 0 10px; 
      background:#fff; 
      border-radius:26px; 
      padding:8px 12px;
      display:flex; 
      align-items:center; 
      gap:8px; 
      box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    .search input{
      border:none; outline:none; width:100%; font-size:14px; color:#0f172a;
      background:transparent;
    }

    .tabs{
      display:inline-flex;
      border-radius:999px;
      background:#12212f;
      padding:3px;
      border:1px solid rgba(255,255,255,.08);
      margin:4px 0 14px;
    }
    .tab-btn{
      border:none;
      background:transparent;
      color:rgba(255,255,255,.7);
      padding:6px 14px;
      font-size:13px;
      border-radius:999px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .tab-btn span.emoji{
      font-size:14px;
    }
    .tab-btn.active{
      background:#ffffff;
      color:#0b1622;
      font-weight:600;
      box-shadow:0 2px 8px rgba(0,0,0,.25);
    }
    .tab-btn:not(.active):hover{
      background:rgba(255,255,255,.06);
    }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .card{
      background:var(--card); color:var(--text);
      border-radius:14px; overflow:hidden; display:flex; flex-direction:column;
      box-shadow:0 4px 14px rgba(0,0,0,.25); cursor:pointer; transition:transform .12s ease;
    }
    .card:active{transform:scale(.98)}
    .thumb{width:100%; aspect-ratio:1/1; background:#e9eef5; display:block; overflow:hidden}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .body{padding:10px 10px 12px; display:flex; flex-direction:column; gap:6px}
    .name{font-size:13px; font-weight:600; line-height:1.3; height:34px; overflow:hidden}
    .price{font-size:13px; color:var(--brand)}
    .badge-platform{
      display:inline-block;
      margin-top:2px;
      padding:2px 6px;
      border-radius:999px;
      font-size:10px;
      background:#0b1622;
      color:#ffead7;
      align-self:flex-start;
    }

    .empty{color:var(--muted); text-align:center; margin:36px 0; font-size:13px}

    .fab{
      position:fixed;
      right:16px;
      width:56px;
      height:56px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      text-decoration:none;
      box-shadow:0 4px 12px rgba(0,0,0,.4);
      cursor:pointer;
      z-index:10;
      transition:transform .15s ease, box-shadow .15s ease;
      background:#555;
    }
    .fab:hover{
      transform:scale(1.08);
      box-shadow:0 6px 16px rgba(0,0,0,.5);
    }
    .fab img{
      width:30px;
      height:30px;
      pointer-events:none;
    }
    .fab-tele{
      bottom:86px;
      background:#0088cc;
    }
    .fab-wa{
      bottom:20px;
      background:#25D366;
    }
  </style>
</head>
<body>

  <!-- ðŸ”¥ BLOK STICKY ATAS: header + search + tabs -->
  <div class="top-shell">
    <div class="header">
      <h1>ðŸ§º Rekomendasi Outfit</h1>
      <p>Inspirasi Outfit Kamu</p>
    </div>
    <div class="top-inner">
      <div class="search">
        <input id="q" placeholder="cari/klik disini mau cari bio no berapa..." />
      </div>

      <div class="tabs">
        <button id="tab-shopee" class="tab-btn active" onclick="setTab('shopee')">
          <span class="emoji">ðŸ›’</span><span>Shopee</span>
        </button>
        <button id="tab-tiktok" class="tab-btn" onclick="setTab('tiktok')">
          <span class="emoji">ðŸŽµ</span><span>TikTok</span>
        </button>
      </div>
    </div>
  </div>

  <!-- LIST PRODUK -->
  <div class="wrap">
    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none">Gagal memuat data.</div>
  </div>

  <a class="fab fab-tele" target="_blank"
     href="https://t.me/infobelanjagratisshopee" rel="noopener">
    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png"
         alt="Channel Telegram" loading="lazy">
  </a>

  <a class="fab fab-wa" target="_blank"
     href="https://whatsapp.com/channel/0029VbAjaXOBvvsiyKOMZn2s" rel="noopener">
    <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"
         alt="Channel WA" loading="lazy">
  </a>

  <script>
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnrxnXyTSBK5-681-9abCMWcJZMWUIVhr3z4uhKiiFOf-qPXmKsgc307TAoGniV6ryu-plqUSaCw23/pub?gid=0&single=true&output=csv";

    const NO_IMAGE = "https://via.placeholder.com/300x300?text=No+Image";

    let ALL = [];
    let CURRENT_TAB = "shopee";

    function isShopee(link=""){
      return /shopee\.co\.id|s\.shopee\.co\.id/i.test(link);
    }
    function isTikTok(link=""){
      return /tiktok\.com|vt\.tiktok\.com/i.test(link);
    }

    function openShopee(link) {
      try {
        const deep = "shopee://external?url=" + encodeURIComponent(link);
        const timer = setTimeout(() => window.open(link, "_blank"), 400);
        window.location.href = deep;
        void 0;
      } catch (e) {
        window.open(link, "_blank");
      }
    }

    function openLink(link){
      if (isShopee(link)) openShopee(link);
      else window.open(link, "_blank");
    }

    function setTab(name){
      CURRENT_TAB = name;
      ["shopee","tiktok"].forEach(t => {
        const btn = document.getElementById("tab-" + t);
        if (!btn) return;
        if (t === name) btn.classList.add("active");
        else btn.classList.remove("active");
      });
      render();
    }

    function render(list = ALL) {
      const q = document.getElementById("q").value.trim().toLowerCase();
      const wrap = document.getElementById("list");
      const empty = document.getElementById("empty");
      wrap.innerHTML = "";

      const byPlatform = list.filter(p => {
        if (CURRENT_TAB === "shopee") return p.platform === "Shopee" || isShopee(p.link);
        if (CURRENT_TAB === "tiktok") return p.platform === "TikTok" || isTikTok(p.link);
        return true;
      });

      const items = byPlatform.filter(p => {
        if (!q) return true;
        return (p.name || "").toLowerCase().includes(q) ||
               (p.tags || "").toLowerCase().includes(q) ||
               String(p.no || "").includes(q);
      });

      if (!items.length){
        empty.style.display = "block";
        empty.textContent = CURRENT_TAB === "shopee"
          ? "Belum ada produk Shopee yang cocok."
          : "Belum ada produk TikTok yang cocok.";
        return;
      } else {
        empty.style.display = "none";
      }

      items.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => openLink(p.link);

        const thumb = document.createElement("div");
        thumb.className = "thumb";
        const img = document.createElement("img");
        img.src = p.image || NO_IMAGE;
        img.alt = p.name || "Produk";
        img.onerror = () => { img.onerror = null; img.src = NO_IMAGE; };
        thumb.appendChild(img);

        const body = document.createElement("div");
        body.className = "body";

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = (p.no ? `#${p.no} ` : "") + (p.name || "Produk");

        const price = document.createElement("div");
        price.className = "price";
        if (p.price) price.textContent = p.price;

        const badge = document.createElement("div");
        badge.className = "badge-platform";
        badge.textContent = p.platform || (isShopee(p.link) ? "Shopee" : (isTikTok(p.link) ? "TikTok" : "Link"));

        body.appendChild(name);
        if (p.price) body.appendChild(price);
        body.appendChild(badge);

        card.appendChild(thumb);
        card.appendChild(body);
        wrap.appendChild(card);
      });
    }

    async function loadData() {
      try {
        const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error(res.status + " " + res.statusText);
        const csv = await res.text();

        const rows = csv
          .trim()
          .split(/\r?\n/)
          .map(line => {
            const out = [];
            let cur = "", inQ = false;
            for (let i = 0; i < line.length; i++) {
              const ch = line[i];
              if (ch === '"' ) {
                if (inQ && line[i+1] === '"') { cur += '"'; i++; }
                else inQ = !inQ;
              } else if (ch === ',' && !inQ) {
                out.push(cur); cur = "";
              } else cur += ch;
            }
            out.push(cur);
            return out;
          });

        const [hdr, ...data] = rows;
        const idx = Object.fromEntries(hdr.map((h,i)=>[ (h||"").trim().toLowerCase(), i ]));

        const get = (row, key) => {
          const i = idx[key];
          if (i === undefined) return "";
          return (row[i] || "").replace(/^"|"$/g,"").trim();
        };

        const all = [];

        data.forEach(r => {
          // Shopee (Aâ€“G)
          const linkS = get(r,"link");
          if (linkS) {
            all.push({
              no   : get(r,"no"),
              name : get(r,"name") || "Produk",
              link : linkS,
              image: get(r,"image"),
              price: get(r,"price"),
              tags : get(r,"tags"),
              platform: get(r,"platform") || "Shopee"
            });
          }

          // TikTok (Hâ€“N)
          const linkT = get(r,"link_tk");
          if (linkT) {
            all.push({
              no   : get(r,"no_tk"),
              name : get(r,"name_tk") || "Produk",
              link : linkT,
              image: get(r,"image_tk"),
              price: get(r,"price_tk"),
              tags : get(r,"tags_tk"),
              platform: get(r,"platform_tk") || "TikTok"
            });
          }
        });

        ALL = all;
        render();
      } catch (err) {
        console.error("Load error:", err);
        const empty = document.getElementById("empty");
        empty.style.display = "block";
        empty.textContent = "Gagal memuat data.";
      }
    }

    document.getElementById("q").addEventListener("input", () => render());
    loadData();
  </script>
</body>
</html>
