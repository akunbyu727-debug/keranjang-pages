<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rekomendasi Outfit</title>

  <link rel="preconnect" href="https://docs.google.com">
  <link rel="preconnect" href="https://down-id.img.susercontent.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0b1622; --card:#ffffff; --text:#0b0f19;
      --brand:#ff6b00; --brand2:#ff914d; --muted:#8aa0b7;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:#fff;
    }

    /* ðŸ”¥ STICKY BLOCK (header + search + tabs) */
    .sticky-top {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--bg);
      padding-bottom: 10px;
    }

    /* HEADER */
    .header{
      background:linear-gradient(90deg,var(--brand2),var(--brand));
      padding:18px 16px 20px;
      text-align:center;
      border-radius:0 0 18px 18px;
      box-shadow:0 6px 14px rgba(0,0,0,.18);
    }
    .header h1{font-size:20px; font-weight:800}
    .header p{font-size:13px; opacity:.9; margin-top:4px}

    /* SEARCH */
    .search{
      margin:14px auto 12px;
      background:#fff; 
      border-radius:26px;
      padding:8px 12px;
      max-width:480px;
      display:flex;
      gap:8px;
      align-items:center;
      box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    .search input{
      flex:1;
      border:none;
      outline:none;
      background:transparent;
      font-size:14px;
      color:#0b1622;
    }

    /* TABS */
    .tabs{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:4px;
    }
    .tab-btn{
      border:none;
      padding:8px 14px;
      font-size:13px;
      border-radius:999px;
      cursor:pointer;
      background:#12212f;
      color:#b7c8d9;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .tab-btn.active{
      background:#fff;
      color:#0b1622;
      font-weight:700;
      box-shadow:0 2px 8px rgba(0,0,0,.25);
    }

    /* LIST WRAPPER */
    .wrap{
      max-width:480px;
      margin:0 auto;
      padding:14px;
      padding-bottom:100px;
    }

    /* GRID */
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .card{
      background:#fff;
      color:#0b1622;
      border-radius:14px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      box-shadow:0 4px 14px rgba(0,0,0,.25);
      cursor:pointer;
    }
    .thumb{aspect-ratio:1/1; background:#e9eef5}
    .thumb img{width:100%; height:100%; object-fit:cover}
    .body{padding:10px; display:flex; flex-direction:column; gap:6px}
    .name{font-size:13px; font-weight:600; height:34px; overflow:hidden}
    .price{font-size:13px; color:var(--brand)}
    .badge-platform{
      font-size:10px; padding:2px 6px; border-radius:999px;
      background:#0b1622; color:#ffead7; align-self:flex-start;
    }

    .empty{text-align:center; color:#8aa0b7; margin-top:20px; font-size:13px}

    /* FLOAT BUTTONS */
    .fab{
      position:fixed; right:16px; width:56px; height:56px;
      border-radius:50%; display:flex; justify-content:center; align-items:center;
      box-shadow:0 4px 12px rgba(0,0,0,.4);
      z-index:30; cursor:pointer;
    }
    .fab img{width:30px}
    .fab-tele{bottom:86px; background:#0088cc}
    .fab-wa{bottom:20px; background:#25D366}
  </style>
</head>

<body>

  <!-- ðŸ”¥ ALL STICKY ELEMENTS HERE -->
  <div class="sticky-top">
    <div class="header">
      <h1>ðŸ§º Rekomendasi Outfit</h1>
      <p>Inspirasi Outfit Kamu</p>
    </div>

    <div class="search">
      <input id="q" placeholder="cari/klik disini mau cari bio no berapa..." />
    </div>

    <div class="tabs">
      <button id="tab-shopee" class="tab-btn active" onclick="setTab('shopee')">ðŸ›’ Shopee</button>
      <button id="tab-tiktok" class="tab-btn" onclick="setTab('tiktok')">ðŸŽµ TikTok</button>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="wrap">
    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none">Gagal memuat data.</div>
  </div>

  <!-- FLOAT WA + TELE -->
  <a class="fab fab-tele" href="https://t.me/infobelanjagratisshopee" target="_blank">
    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram">
  </a>

  <a class="fab fab-wa" href="https://whatsapp.com/channel/0029VbAjaXOBvvsiyKOMZn2s" target="_blank">
    <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
  </a>

  <!-- SCRIPT CSV + FILTER -->
  <script>
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnrxnXyTSBK5-681-9abCMWcJZMWUIVhr3z4uhKiiFOf-qPXmKsgc307TAoGniV6ryu-plqUSaCw23/pub?gid=0&single=true&output=csv";

    const NO_IMAGE = "https://via.placeholder.com/300x300?text=No+Image";

    let ALL = [];
    let CURRENT_TAB = "shopee";

    function isShopee(l){return /shopee\.co\.id|s\.shopee/i.test(l || "");}
    function isTikTok(l){return /tiktok\.com|vt\.tiktok\.com/i.test(l || "");}

    function openLink(l){ if (l) window.open(l,"_blank"); }

    function setTab(x){
      CURRENT_TAB = x;
      document.getElementById("tab-shopee").classList.toggle("active", x === "shopee");
      document.getElementById("tab-tiktok").classList.toggle("active", x === "tiktok");
      render();
    }

    // ðŸ”§ CSV parser aman (handle koma di dalam "")
    function parseCSV(str) {
      const rows = [];
      let cur = '';
      let row = [];
      let inQuotes = false;

      for (let i = 0; i < str.length; i++) {
        const c = str[i];
        if (c === '"') {
          if (inQuotes && str[i+1] === '"') { 
            cur += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (c === ',' && !inQuotes) {
          row.push(cur);
          cur = '';
        } else if ((c === '\n' || c === '\r') && !inQuotes) {
          if (cur || row.length) row.push(cur);
          if (row.length) rows.push(row);
          cur = '';
          row = [];
        } else {
          cur += c;
        }
      }
      if (cur || row.length) row.push(cur);
      if (row.length) rows.push(row);
      return rows;
    }

    function render(list = ALL){
      // ðŸ”¥ TRIM biar spasi dari keyboard HP gak ganggu
      const q = document.getElementById("q").value.trim().toLowerCase();

      const wrap = document.getElementById("list");
      wrap.innerHTML = "";
      const empty = document.getElementById("empty");

      const byPlatform = list.filter(p =>
        CURRENT_TAB === "shopee"
          ? p.platform === "Shopee" || isShopee(p.link)
          : p.platform === "TikTok" || isTikTok(p.link)
      );

      const items = byPlatform.filter(p =>
        (p.name||"").toLowerCase().includes(q) ||
        (p.tags||"").toLowerCase().includes(q) ||
        String(p.no||"").includes(q)
      );

      if(!items.length){
        empty.style.display = "block";
        empty.textContent = CURRENT_TAB==="shopee"
          ? "Belum ada produk Shopee yang cocok."
          : "Belum ada produk TikTok yang cocok.";
        return;
      }
      empty.style.display = "none";

      items.forEach(p=>{
        const img = p.image || NO_IMAGE;
        wrap.innerHTML += `
          <div class="card" onclick="openLink('${p.link || ""}')">
            <div class="thumb">
              <img src="${img}">
            </div>
            <div class="body">
              <div class="name">#${p.no || ''} ${p.name || 'Produk'}</div>
              ${p.price ? `<div class="price">${p.price}</div>` : ""}
              <div class="badge-platform">${p.platform}</div>
            </div>
          </div>
        `;
      });
    }

    async function loadData(){
      try{
        const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now());
        const csv = await res.text();

        const rows = parseCSV(csv);
        if (!rows.length) return;

        const [head, ...data] = rows;
        const idx = Object.fromEntries(
          head.map((h,i)=>[(h || "").trim().toLowerCase(), i])
        );

        function get(row, key){
          const i = idx[key];
          if (i === undefined) return "";
          return (row[i] || "").trim();
        }

        const raw = data.map(r=>({
          no: get(r,"no"),
          name: get(r,"name"),
          link: get(r,"link"),
          image: get(r,"image"),
          price: get(r,"price"),
          tags: get(r,"tags"),
          platform: get(r,"platform"),
          no_tk: get(r,"no_tk"),
          name_tk: get(r,"name_tk"),
          link_tk: get(r,"link_tk"),
          image_tk: get(r,"image_tk"),
          price_tk: get(r,"price_tk"),
          tags_tk: get(r,"tags_tk"),
          platform_tk: get(r,"platform_tk"),
        }));

        ALL = raw.flatMap(p=>[
          p.link ? {
            no:p.no,
            name:p.name || "Produk",
            link:p.link,
            image:p.image,
            price:p.price,
            tags:p.tags,
            platform:p.platform || "Shopee"
          } : null,
          p.link_tk ? {
            no:p.no_tk,
            name:p.name_tk || "Produk",
            link:p.link_tk,
            image:p.image_tk,
            price:p.price_tk,
            tags:p.tags_tk,
            platform:p.platform_tk || "TikTok"
          } : null
        ].filter(Boolean));

        render();
      }catch(e){
        console.error(e);
      }
    }

    // âœ… Panggil render tanpa kirim event
    document.getElementById("q").addEventListener("input", () => render());

    loadData();
  </script>

</body>
</html>
